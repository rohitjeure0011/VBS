<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Statement - Secure Banking System</title>

    <style>
        *{margin:0;padding:0;box-sizing:border-box}

        body{
            font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
            background:linear-gradient(135deg,#0c2461 0%,#1e3799 100%);
            min-height:100vh;
            padding:20px
        }

        .container{
            max-width:1000px;
            margin:auto;
            background:#fff;
            border-radius:20px;
            box-shadow:0 20px 60px rgba(0,0,0,.3);
            overflow:hidden;
            border:1px solid rgba(255,255,255,0.1)
        }

        .header{
            background:linear-gradient(135deg,#0c2461 0%,#1e3799 100%);
            padding:30px;
            color:#fff;
            display:flex;
            justify-content:space-between;
            align-items:center;
            border-bottom:2px solid rgba(255,255,255,0.1)
        }

        .header-left h1{
            font-size:28px;
            display:flex;
            align-items:center;
            gap:10px
        }
        .header-left h1:before{content:"üè¶";font-size:32px}
        .header-left p{font-size:14px;opacity:.9;color:#d1d8ff}

        .btn-header{
            padding:10px 20px;
            border:1px solid rgba(255,255,255,0.2);
            background:rgba(255,255,255,.15);
            color:#fff;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
            text-decoration:none;
            transition:.3s;
            display:flex;
            align-items:center;
            gap:8px
        }

        .btn-header:hover{
            background:rgba(255,255,255,.25);
            transform:translateY(-2px)
        }

        .content{padding:40px 30px}

        .passbook-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:30px;
            flex-wrap:wrap;
            gap:20px
        }

        .passbook-header h2{
            color:#0c2461;
            font-size:24px;
            display:flex;
            align-items:center;
            gap:10px
        }
        .passbook-header h2:before{content:"üìã"}

        .balance-card{
            background:linear-gradient(135deg,#1e3799 0%,#4a69bd 100%);
            color:#fff;
            padding:20px 30px;
            border-radius:15px;
            box-shadow:0 5px 15px rgba(12,36,97,0.2);
            border:1px solid rgba(255,255,255,0.1);
            min-width:250px
        }

        .balance-card p{font-size:14px;color:#d1d8ff;margin-bottom:5px}
        .balance-card .amount{font-size:28px;font-weight:700;display:flex;align-items:center;gap:10px}
        .balance-card .amount:before{content:"üí∞"}

        .transactions-section{
            background:#f8f9fa;
            padding:30px;
            border-radius:15px;
            border:1px solid #e8ecf5
        }

        .transactions-list{display:flex;flex-direction:column;gap:10px}

        .transaction-item{
            background:#fff;
            padding:18px;
            border-radius:10px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            border-left:5px solid #1e3799;
            box-shadow:0 2px 8px rgba(0,0,0,.05);
            transition:all 0.3s
        }

        .transaction-item:hover{
            transform:translateY(-2px);
            box-shadow:0 5px 15px rgba(12,36,97,0.1)
        }

        .transaction-item.deposit{border-left-color:#27ae60}
        .transaction-item.withdrawal{border-left-color:#e74c3c}
        .transaction-item.transfer{border-left-color:#3498db}

        .transaction-info{display:flex;gap:15px;align-items:center}

        .transaction-icon{
            width:45px;height:45px;
            border-radius:50%;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:22px
        }

        .deposit .transaction-icon{background:#e8f5e9;color:#27ae60;border:1px solid #c8e6c9}
        .withdrawal .transaction-icon{background:#ffebee;color:#e74c3c;border:1px solid #ffcdd2}
        .transfer .transaction-icon{background:#e3f2fd;color:#3498db;border:1px solid #bbdefb}

        .transaction-details .type{font-weight:600;color:#333}
        .transaction-details .date{font-size:12px;color:#999}

        .transaction-right{text-align:right}

        .transaction-amount{
            font-size:16px;
            font-weight:700;
            display:flex;
            align-items:center;
            gap:5px
        }
        .deposit .transaction-amount{color:#27ae60}
        .deposit .transaction-amount:before{content:"‚¨ÜÔ∏è"}
        .withdrawal .transaction-amount{color:#e74c3c}
        .withdrawal .transaction-amount:before{content:"‚¨áÔ∏è"}
        .transfer .transaction-amount{color:#3498db}
        .transfer .transaction-amount:before{content:"üîÑ"}

        .balance-display{font-size:12px;color:#999;display:flex;align-items:center;gap:5px}
        .balance-display:before{content:"üí∞"}

        .pagination{
            margin-top:20px;
            display:flex;
            justify-content:center;
            gap:10px;
            flex-wrap:wrap
        }

        .pagination button{
            padding:8px 15px;
            border:1px solid #ddd;
            background:white;
            border-radius:8px;
            cursor:pointer;
            font-weight:500;
            transition:all 0.3s;
            color:#333
        }

        .pagination .active{
            background:linear-gradient(135deg,#1e3799 0%,#4a69bd 100%);
            color:#fff;
            border-color:#1e3799
        }

        .pagination button:hover:not(.active){
            border-color:#1e3799;
            color:#1e3799
        }

        .header > div{display:flex;gap:10px}
        .btn-header{min-width:130px;height:42px;display:inline-flex;align-items:center;justify-content:center}

        .message{display:none;margin-bottom:20px}
        .message.show{display:block}

        .empty-state{
            text-align:center;
            color:#999;
            padding:40px 20px
        }

        .empty-state-icon{
            font-size:48px;
            margin-bottom:15px
        }

        .empty-state-text{
            font-size:16px;
            color:#666
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar{width:8px;height:8px}
        ::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}
        ::-webkit-scrollbar-thumb{background:#1e3799;border-radius:4px}
        ::-webkit-scrollbar-thumb:hover{background:#0c2461}
    </style>
</head>

<body>
<div class="container">

    <div class="header">
        <div class="header-left">
            <h1>Secure Bank Statement</h1>
            <p>Account Transaction History</p>
        </div>
        <div>
            <a id="dashLink" class="btn-header">üè† Dashboard</a>
            <button class="btn-header" onclick="logout()">üö™ Logout</button>
        </div>
    </div>

    <div class="content">

        <div class="passbook-header">
            <h2>Account Statement</h2>
            <div class="balance-card">
                <p>Current Available Balance</p>
                <div class="amount">‚Çπ<span id="currentBalance">0.00</span></div>
            </div>
        </div>

        <div class="transactions-section">
            <div id="transactionsList" class="transactions-list">
                <div class="empty-state">
                    <div class="empty-state-icon">üè¶</div>
                    <div class="empty-state-text">Loading transaction history...</div>
                </div>
            </div>
            <div id="paginationControls" class="pagination"></div>
        </div>

    </div>
</div>

<script>
    const API_URL = 'http://localhost:8081';
    let userId, role;
    let transactions = [];
    let currentPage = 1;
    const itemsPerPage = 10;

    function getUserIdFromURL(){
        const p = new URLSearchParams(window.location.search);
        userId = p.get('id');
        role = p.get('role') || 'customer';
        if(!userId) location.href='login.html';
        document.getElementById('dashLink').href =
            `dashboard.html?id=${userId}&role=${encodeURIComponent(role)}`;
    }

    async function loadPassbook(){
        try {
            const r = await fetch(`${API_URL}/passbook/${userId}`);
            if(!r.ok) throw new Error('Failed to load statement');

            transactions = await r.json();

            if(transactions.length === 0) {
                document.getElementById('transactionsList').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <div class="empty-state-text">No transactions found</div>
                    </div>
                `;
                return;
            }

            document.getElementById('currentBalance').textContent =
                transactions[transactions.length-1].currBalance.toFixed(2);
            render();
        } catch(error) {
            console.error('Error loading statement:', error);
            document.getElementById('transactionsList').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">‚ùå</div>
                    <div class="empty-state-text">Failed to load account statement</div>
                </div>
            `;
        }
    }

    function getType(d){
        d = d.toLowerCase();
        if(d.includes('deposit')) return 'deposit';
        if(d.includes('withdrawal')) return 'withdrawal';
        if(d.includes('transfer')) return 'transfer';
        return 'transfer';
    }

    function getIcon(type, description){
        if(type === 'deposit') return 'üí∞';
        if(type === 'withdrawal') return 'üí≥';
        if(description.toLowerCase().includes('received')) return 'üì•';
        if(description.toLowerCase().includes('sent')) return 'üì§';
        return 'üîÑ';
    }

    function render(){
        const list = document.getElementById('transactionsList');
        const pag = document.getElementById('paginationControls');

        const sorted = [...transactions].sort((a,b) => new Date(b.date) - new Date(a.date));
        const totalPages = Math.ceil(sorted.length / itemsPerPage);
        const slice = sorted.slice((currentPage-1) * itemsPerPage, currentPage * itemsPerPage);

        list.innerHTML = slice.map(t => {
            const type = getType(t.description);
            const icon = getIcon(type, t.description);

            let sign = '-';
            if(type === 'deposit') sign = '+';
            else if(type === 'transfer' && t.description.toLowerCase().includes('received'))
                sign = '+';

            return `
            <div class="transaction-item ${type}">
                <div class="transaction-info">
                    <div class="transaction-icon">${icon}</div>
                    <div class="transaction-details">
                        <div class="type">${t.description}</div>
                        <div class="date">${new Date(t.date).toLocaleString('en-IN')}</div>
                    </div>
                </div>
                <div class="transaction-right">
                    <div class="transaction-amount">‚Çπ${t.amount.toFixed(2)}</div>
                    <div class="balance-display">Balance ‚Çπ${t.currBalance.toFixed(2)}</div>
                </div>
            </div>`;
        }).join('');

        pag.innerHTML = '';
        if(totalPages > 1) {
            if(currentPage > 1) {
                pag.innerHTML += `<button onclick="go(${currentPage - 1})">‚¨ÖÔ∏è Previous</button>`;
            }

            for(let i = 1; i <= totalPages; i++) {
                if(i === currentPage) {
                    pag.innerHTML += `<button class="active">${i}</button>`;
                } else if(i <= 3 || i >= totalPages - 2 || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    pag.innerHTML += `<button onclick="go(${i})">${i}</button>`;
                } else if(i === 4 || i === totalPages - 3) {
                    pag.innerHTML += `<button disabled>...</button>`;
                }
            }

            if(currentPage < totalPages) {
                pag.innerHTML += `<button onclick="go(${currentPage + 1})">Next ‚û°Ô∏è</button>`;
            }
        }
    }

    function go(p){
        currentPage = p;
        render();
    }

    function logout(){
        localStorage.removeItem("userId");
        localStorage.removeItem("role");
        location.href = 'home.html';
    }

    window.onload = () => {
        getUserIdFromURL();
        loadPassbook();
    }
</script>
</body>
</html>